## 第01章 初识Kafka

1. 数据（消息）第发送者（发布者）不会直接把消息发送给接收者，这是发布与订阅消息系统的一个特点。发布者以某种方式对消息进行分类，接收者（订阅者）订阅它们，以便接收特定类型的消息。发布者与订阅系统一般会有一个broker，也就是发布消息的中心点。
2. 点对点 ——> 抽象出特定数据层 ——>通用消息层。
3. Kafka一般被称为“分布式提交日志”或者“分布式流平台”。文件系统或数据库提交日志来提供所有事务的持久纪录，通过重放这些日志可以重建系统的状态。同样地，Kafka的数据是按照一定顺序持久化保存的，可以按需读取。
4. Kafka的数据单元被称为消息。如果你在使用Kafka之前已经有数据库使用的经验，那么可以把消息看成是数据库里的一个“数据行”或一条“记录”。消息由字节数组组成，所以对于Kafka来说，消息里的数据没有特别的格式或含义。消息可以有一个可选的元数据，也就是键。键也是一个字节数组，与消息一样，对于Kafka来说也没有特殊的含义。当消息以一种可控的方式写入不同的分区时，会用到键。键也是一个字节数组，与消息一样，对于Kafka来说也没有特殊的含义。当消息以一种可控的方式写入不同的分区时，会用到键。
5. 批次就是一组消息，这些消息属于同一个主题和分区。需要在延迟和吞吐量之间做出权衡。
6. Kafka的消息通过主题进行分类。主题就好比数据库的表，或者文件系统里的文件夹。主题可以被分为若干个分区，一个分区就是一个提交日志。消息以追加的方式写入分区，然后以先进先出的顺序读取。无法在整个主体范围内保证消息的顺序，但可以保证消息在单个分区内的顺序。Kafka通过分区来实现数据冗余和伸缩性。分区可以分布在不同的服务器上。
7. Kafka的客户端就是Kafka系统的用户，它们被分为两种基本类型：生产者和消费者。
8. 生产者创建消息。生产者在默认情况下把消息均衡地分布到主题的所有分区上，而并不关心特定的消息会被写道哪个分区。不过，在某些情况下，生产者会把消息直接写到指定的分区。这通常是通过消息键和分区器来实现的，分区器为键生成一个散列值，并将其映射到指定的分区上。
9. 消费者读取消息。并按照消息生成的顺序读取它们。通过检查消息的偏移量来区分已经读过的消息。偏移量是另一种元数据，它是一个不断递增的整数值，在创建消息时，Kafka会把它添加到消息里。消息偏移量保存在Zookeeper或Kafka上。
10. 消费者是消费者群组的一部分。群组保证每个分区只能被一个消费者使用。（一个分区只能有一个消费者消费，一个消费者可以消费多个分区）
11. 一个独立的Kafka服务器被称为broker。broker接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。brker为消费者提供服务，对读取分区的请求作出响应，返回意见提交到磁盘上的消息。
12. broker是集群的组成部分。每个集群都有一个broker同时充当来集群控制器的角色。控制器负责管理工作，包括将分区配给broker和监控broker。在集群中，一个分区从属于一个brker，该broker被称为分区的首领。一个分区可以分配给多个broker，这个时候会发生分区复制。（分区复制仅仅是做数据冗余）
13. Kafka broker默认的消息保留策略：要么保留一段时间，要么保留到消息到达一定大小的字节数。当消息数量达到这些上限时，旧消息就会过期并被删除。主题可以配置自己的保留策略。
14. Kafka的消息复制机制只能在单个集群里进行，不能在多个集群之间进行。Kafka提供了一个叫做MirrorMaker的工具，可以用它来实现集群间的消息复制。MirrorMaker的核心组件包括了一个生产者和一个消费者，两者之间通过一个队列相连。消费者懂一个集群读取消息，生产者把消息发送到另一个集群上。