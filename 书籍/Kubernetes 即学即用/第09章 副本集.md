## 第09章 副本集

1. 副本集是集群范围的Pod管理器，可以确保任何时刻均有一定类型和数量的Pod始终处于运行状态。
2. 管理多个相同的Pod的实际操作是一个协调循环。Kubernetes的大多数设计和实现都以协调循环为基础。
3. 协调循环背后的核心概念是所需状态与观察状态之间的比较。
4. Kubernetes所有的核心概念都是模块化的，这些模块之间不仅相互关联，而且还可以互换或用其他组件替换。本着这种思想，副本集和Pod之间的关系也是松散耦合的。尽管副本集可以创建和管理Pod，但它们并不拥有Pod。副本集使用标签查询来标识他们应管理的Pod集。然后，再使用API来创建Pod。
5. “走正门”是Kubernetes另一个核心设计概念。出于同样的解耦目的，创建多个Pod的副本集与为这些Pod提供负载均衡的服务也是完全独立的、解耦的API对象。
6. 因为副本集与Pod是解耦的，所以可以通过创建副本集来容纳现有的Pod。
7. 副本集的主旨是表示体系结构中的单个可伸缩微服务。副本集的关键特点是，副本集控制器创建的每个Pod都完全相同。一般来说，副本集是无状态服务设计的。由副本集创建的元素都是可以互换的。当副本集规模收缩时，本删除的Pod也是随机选择的。应用程序的行为不应该因此发生变化。
8. 所有副本集都必须包含：一个唯一的名称（由metadata.name字段定义）；一个spec小节，用于描述某个时间点上应在集群范围内运行的Pod数量；一个Pod模板，用于描述副本数量不足时应该创建的Pod。
9. 副本集使用一组Pod标签监视集群状态。标签可以过滤Pod列表，并跟踪集群中运行的Pod。
10. 副本集控制器在其创建的每个Pod中添加了一个注释。注释的键时kubernetes.io/create-by/
11. 查找副本集管理的Pod集合即模拟副本集使用标签过滤。
12. 副本集的命令式伸缩：kubectl scale
13. 副本集的声明式伸缩：kubectl apply（即修改相关对象yaml文件）
14. HPA要求集群上必须存在heapster Pod。heapster可以跟踪指标，而且还提供了一个API，HPA会利用这些指标来指定伸缩决策。
15. Kubernetes的自动伸缩分为水平自动伸缩和垂直自动伸缩两种，其中水平自动伸缩指的时创建额外的Pod副本；而垂直自动伸缩则需要增加特定Pod所需的资源。
16. 运行如下命令实现副本集的自动伸缩：kubectl autoscale rs xxx --min=? --max=? --cpu-precen=?
17. 通过kubectl get hpa 查看自动伸缩的副本集。
18. 当不再需要某个副本集时，使用kubectl delete rs命令删除。默认情况下，这个操作还会删除副本集管理的Pod。如果你不想删除副本集管理的Pod，额外附加--cascade=false即可。