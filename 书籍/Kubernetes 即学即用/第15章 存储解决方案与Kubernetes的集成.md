## 第15章 存储解决方案与Kubernetes的集成

1. 在许多情况下，将状态从应用程序中解耦出来，并尽可能按照无状态的方式构建微服务，可以获得最可靠，最容易管理的系统。
2. 使用命名空间来群发不同的环境。
3. 外部服务没有标签查询。Kubernetes在创建普通的服务时，会同时创建一个IP地址，并向DNS服务中添加一条A记录指向这个地址。但在创建类型为ExternalName服务时，Kubernetes DNS服务中添加一条指向你指定的外部名称的CNAME记录：
   1. 创建一个不代标签选择器的服务，只有IP地址。
   2. 通过Endpoints资源手动添加端点。
4. Kubernetes中的外部服务有一个重要的限制：他们不执行任何健康检查。
5. Pod一旦被调度到某台计算机上，那么就相当于这个Pod永久地绑定到了该计算机上。如果计算机发生故障，那么这台计算机上所有未被更高级别的控制器（比如副本集）管理的Pod都会随着计算机一起消失，而且不会被重新调度到其他地方。
6. 当动态供应看到存储声明后，它会使用相应驱动程序来创建卷，并将其绑定到持久卷声明。
7. 这些持久卷的生命周期由PersistentVolumeClaim的回收策略决定，默认情况下其生命周期依赖于创建该卷的Pod的生命周期。
8. 状态机时Pod副本的集合，类似于副本集。但与副本集不同的是，状态集具有某些独特的属性：
   1. 每个副本都具有持久的主机名，并且带有唯一的索引。
   2. 每个副本都是按照从低到高的索引顺序创建的，并且在前一个Pod能够正常运行之前，不会继续创建下一个Pod。扩大规模时也如此。
   3. 删除状态集时，每个托管到副本的Pod都会按照从高到低的顺序删除。缩减副本数量时亦如此。
9. 状态集与副本集有两个重要的区别：第一，每个Pod副本都有一个数字索引，而副本集中则是由副本集控制器添加的随即后缀。第二，Pod是逐步按照顺序创建的，而在副本集中全部是一次性创建完成的。
10. 在Kubernetes中，我们称没有集群虚拟IP地址的服务为“无头”服务。由于使用了状态集，每个Pod都有唯一的标识，因此给这个服务指定一个负载均衡器的IP地址没有任何意义。通过在服务规范中指定clusterIP：None来创建无头服务。
11. 对服务名执行DNS查询将获得状态集的所有地址。使用状态集时，每个副本都能获得明确定义的持久性名称。
12. 状态集的定义要求ConfigMap定义必须存在。（需要使用ConfigMap时）