## 第16章 扩展Kubernetes

1. 一般来说，Kubernetes API服务器的扩展有两种方式：第一，向集群添加新功能，第二，限制并调整用户与集群交互的方式。集群管理与可以利用丰富的插件生态系统，向集群添加其他服务和功能。

2. API服务器的请求流程：

   认证授权 ->准入控制 -> API服务器 -> 存储

3. 在API对象写入后备存储之前，系统会调用准入控制器。准入控制器可以拒绝API请求，还可以对其进行修改。

4. 自定义资源可以与准入控制器一起使用。可以通过自定义资源将全新的API对象添加到Kubernetes API中。

5. 创建自定义资源的第一步是创建CRD。这个对象实际上是一个元资源，也就是说是一个用于定义另一个资源的资源。

6. 自定义资源的名称比较特殊，你必须采用以下格式：```<resource-paural>.<api-group>```(即<资源（复数形式）>.<api组>)。（为了确保每个资源定义在集群中唯一）

7. CRD还有一个spec子对象，资源本身的定义就位于此处。这个spec对象中有一个apigroup字段，负责为该资源提供API组。如前所述，他必须与CRD名称的后缀匹配。此外，还有一个该资源的版本列表。除了版本名称（例如v1、v2等）之外，还有一些字段表明该版本是否由API服务器提供，以及哪个版本可以将数据存储在API服务器的后被存储中。对于只有一个版本的资源而言，storage字段必须为true。还有一个scope字段，用于定义资源的单数、复数和kind值。此外，你还可以定义方便在kubectl和其他地方使用的“简写名称”

8. 如果你需要利用规范进行验证自定义资源的结构，可以注册一个验证准入控制器。

9. 就像API的用户一样控制器通过与API服务器的交互查询资源的列表，并且监视任何可能出现的变化。

10. 如果想安装验证准入控制器，我们需要将其指定为Kubernetes的ValidatingWebhookConfiguration。出于安全性考虑，供Kubernetes API服务器访问的Webhook只能采用HTTPS。

11. 不应该使用Kubernetes API服务器来存储应用程序的数据。

12. 编译器扩展提供了易于使用的抽象，而使用“操作器”模式的扩展能主动管理扩展所创建的资源。